


















    
        
    

    
        

        
            
        
    




<?xml version="1.0" encoding="utf-8"?>

<rss version="2.0"  xml:lang="fr"  xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        

        

        
            <language>fr</language>
        

        
            <lastBuildDate>Sat, 15 Mar 2025 12:00:00 UTC</lastBuildDate>
        

        
            <link>https://www.millegrilles.com/fr/documentation/</link>
        

        
            <atom:link href="https://www.millegrilles.com/fr/documentation/rss.xml" hreflang="fr" rel="self" type="application/rss+xml"/>
        

        
            

            <atom:link href="https://www.millegrilles.com/fr/documentation/" hreflang="fr" rel="alternate" type="text/html"/>
        
            

            <atom:link href="https://www.millegrilles.com/fr/documentation/rss.xml" hreflang="fr" rel="alternate" type="application/rss+xml"/>
        

        
            
                <atom:link href="https://www.millegrilles.com/documentation/" hreflang="en" rel="canonical" type="text/html"/>
            
                <atom:link href="https://www.millegrilles.com/documentation/rss.xml" hreflang="en" rel="alternate" type="application/rss+xml"/>
            
        

        

        
            <title>Documentation · MilleGrilles</title>
        

        

        
            
                <item>
                    
                    
                    
                    
                    
                    
                    

                    

                    

                    

                    

                    
                    
                    

                    

                    
                        <description><![CDATA[<h1 class=h6 id=security-certificates><a class="text-body text-decoration-none" href=#security-certificates>Security certificates</a></h1><p>Voici comment ça marche.</p>]]></description>
                    

                    
                        <guid isPermaLink="false">tag:www.millegrilles.com,2025-03-14:/fr/documentation/certificates/</guid>
                    

                    
                        <link>https://www.millegrilles.com/fr/documentation/certificates/</link>
                    

                    <atom:link href="https://www.millegrilles.com/fr/documentation/certificates/" hreflang="fr" rel="self" type="text/html"/>

                    
                        

                        

                        <atom:link href="https://www.millegrilles.com/fr/documentation/certificates/" hreflang="fr" rel="alternate" type="text/html"/>
                    

                    
                        
                            <atom:link href="https://www.millegrilles.com/documentation/certificates/" hreflang="en" rel="canonical" type="text/html"/>
                        
                    

                    
                        <pubDate>Fri, 14 Mar 2025 12:20:48 UTC</pubDate>
                    

                    
                        <title>Certificats</title>
                    
                </item>
            
        
            
                <item>
                    
                    
                    
                    
                    
                    
                    

                    

                    

                    

                    

                    
                    
                    

                    

                    
                        <description><![CDATA[<h1 class=h5 id=messages-millegrilles><a class="text-body text-decoration-none" href=#messages-millegrilles>Messages MilleGrilles</a></h1><p>Le bus MQ (RabbitMQ) permet d&rsquo;échanger des messages entre les composants d&rsquo;une MilleGrille. Ce bus est sécurisé et
génère les permissions de chaque client en fonction de son certificat système.</p><p>Note : Les certificats usagers ne sont pas autorisés à se connecter au bus de la MilleGrille.</p><p>Les messages et autres documents signés (documents, transactions) ont tous la même structure qui est inspirée
par <a href=https://nostr.com/protocol rel=external>Nostr</a>
.</p><h2 class=h6 id=exemple-de-message><a class="text-body text-decoration-none" href=#exemple-de-message>Exemple de message</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;id&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;b9fead6eef87d8400cbc1a5621600b360438affb9760a6a043cc0bddea21dab6&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;pubkey&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;6e468422dfb74a5738702a8823b9b28168abab8655faacb6853cd0ee15deee93&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;estampille&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>1681650062</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;kind&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>4</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;routage&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>&#34;action&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;fichePublique&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&#34;domaine&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;CoreTopologie&#34;</span><span style=color:#1f2328>,</span> <span style=color:#0550ae>&#34;partition&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;ZABC1&#34;</span><span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;origine&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;zeYncRqEqZ6eTEmUZ8whJFuHG796eSvCTWE4M432izXrp22bAtwGm7Jf&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;dechiffrage&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;cles&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span><span style=color:#0550ae>&#34;6e468422dfb74a5738702a8823b9b28168abab8655faacb6853cd0ee15deee93&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;jSNQFfzeHPq3DoFaj8YMkCdnd4GzCc2qZDUdywFZlDQ&#34;</span><span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;cle_id&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;z4KD61h3yH7jyJBmYYytzCj3Ni6DDW7iSDkuBw9wSUFRo&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;format&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;mgs4&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;nonce&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;EjQ8MmAx5VY12vtJ3ag8rA9j8DMjzuiS&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;pre-migration&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;estampille&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>1671554193</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;id&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;5d0ef4c0-94de-4141-8954-7f006cbbbcfd&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;pubkey&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;10319064594e3990f78a35b288c83b33029ebab0e14206ea92908985022905a9&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;contenu&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;{\&#34;Champ\&#34;:\&#34;valeur\&#34;}&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;sig&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;908a15e46fb4d8675bab026fc230a0e3542bfade63da02d542fb78b2a8513fcd0092619a2c8c1221e581946e0191f2af505dfdf8657a414dbca329186f009262&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;certificat&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>     <span style=color:#0a3069>&#34;-----BEGIN CERTIFICATE-----\nMIIClDCCAkagAwIBAgIUdkc2yl6WSpl ... +GFuCp92IBw==\n-----END CERTIFICATE-----\n&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>     <span style=color:#0a3069>&#34;-----BEGIN CERTIFICATE-----\nMIIBozCCAVWgAwIBAgIKBBdSWFdJiDN ... A6bAfGc7dGHsL\n-----END CERTIFICATE-----\n&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;millegrille&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;-----BEGIN CERTIFICATE-----\nMIIBQzCB9qADAgECAgo ... H94CH4d1VCPwI\n-----END CERTIFICATE-----&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;attachements&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0550ae>&#34;cles&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;pubkey cert destinataire 1&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;cle dechiffrage&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;pubkey cert destinataire 2&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;cle dechiffrage&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span></span></span></code></pre></div><p>Cet exemple inclus tous les champs possibles pour un message. Le type de message (kind) détermine quelle combinaison
d&rsquo;éléments sont supportés.</p><h2 class=h6 id=champs><a class="text-body text-decoration-none" href=#champs>Champs</a></h2><ul><li>id : Hachage blake2s en format hexadécimal des éléments du message. Le kind détermine les champs et l&rsquo;ordre utilisé
pour ce hachage.</li><li>pubkey : Clé publique ed25519 en format hexadécimal utilisée pour signer le message. Les certificats d&rsquo;une MilleGrille
sont indexés par leur clé publique (hex) pour être facilement retrouvé.</li><li>estampille : Temps epoch en secondes (int) qui représente le moment de création du document/message.</li><li>kind : Type de message. Détermine les éléments requis/optionnels, format de séralisation du contenu et leur ordre
d&rsquo;inclusion dans le hachage (id).</li><li>contenu : Contenu sérialisé en chaine de caractères (string). La méthode de sérialisation du contenu dếpend du kind.</li><li>sig : Signature électronique du <strong>id</strong> avec la clé ed25519 privée qui correspond à pubkey.</li><li>certificat : Optionnel mais recommandé - la chaîne de certificats X.509 qui correspond à pubkey.
Exclus le certificat CA (millegrille).</li><li>millegrille : Optionnel - le certificat CA (millegrille).</li><li>attachements : Optionnel - objet avec un format qui dépend du contexte. Toujours exclus de la signature du
document/message.</li><li>origine : Identificateur de MilleGrille (IDMG) de l&rsquo;origine du message.</li><li>dechiffrage : Information requise pour le déchiffrage du contenu. Peut inclure les clés indexées par pubkey ou un
cle_id.</li></ul><h2 class=h6 id=calcul-du-hachage><a class="text-body text-decoration-none" href=#calcul-du-hachage>Calcul du hachage</a></h2><p>Le hachage du message est généré en mettant les éléments appopriés dans une liste JSON et calculant le hachage blake2s
de cette chaîne de caractères.</p><p>Hachage par kind</p><table><thead><tr><th>Kind</th><th>Description</th><th>Hachage</th><th>Format contenu</th></tr></thead><tbody><tr><td>0</td><td>Document</td><td>pubkey, estampille, kind, contenu</td><td>json string</td></tr><tr><td>1</td><td>Requête</td><td>pubkey, estampille, kind, routage, contenu</td><td>json string</td></tr><tr><td>2</td><td>Commande</td><td>pubkey, estampille, kind, routage, contenu</td><td>json string</td></tr><tr><td>3</td><td>Transaction</td><td>pubkey, estampille, kind, routage, contenu</td><td>json string</td></tr><tr><td>4</td><td>Réponse</td><td>pubkey, estampille, kind, contenu</td><td>json string</td></tr><tr><td>5</td><td>Événement</td><td>pubkey, estampille, kind, routage, contenu</td><td>json string</td></tr><tr><td>6</td><td>Réponse chiffrée</td><td>pubkey, estampille, kind, déchiffrage, contenu</td><td>base64 nopad (json string -> mgs4)</td></tr><tr><td>7</td><td>Transaction migrée</td><td>pubkey, estampille, kind, routage, contenu</td><td>json string</td></tr><tr><td>8</td><td>Commande inter-millegrille</td><td>pubkey, estampille, kind, routage, origine, déchiffrage, contenu</td><td>base64 nopad (json string -> mgs4)</td></tr></tbody></table><p>Par exemple, pour le kind:4 - Réponse, le hachage est calculé de la façon suivante:</p><p><code>[pubkey,estampille,kind,contenu]</code></p><p>Pour le message en exemple, on aurait :</p><p><code>["6e468422dfb74a5738702a8823b9b28168abab8655faacb6853cd0ee15deee93",1681650062,4,"{\"Champ\":\"valeur\"}"]</code></p><p>Le message JSON précédent est converti en UTF-8 puis haché avec blake2s. Ceci donne une valeur de 32 bytes
(64 caractères hexadécimaux). Cette valeur devient le <strong>id</strong> du message.</p><p>Note : Pour les champs objet (routage, dechiffrage et pre-migration), il faut s&rsquo;assurer de trier les sous-éléments en ordre
alphabétique pour obtenir la bonne valeur de hachage. Les éléments dans l&rsquo;exemple sont dans le bon ordre.</p><h2 class=h6 id=signature-électronique><a class="text-body text-decoration-none" href=#signature-%c3%a9lectronique>Signature électronique</a></h2><p>Le champ <strong>sig</strong> contient une signature électronique du champ <strong>id</strong>. La signature peut être vérifiée en usilisant le
champ <strong>pubkey</strong> (hex) comme clé ed25519 et le champ <strong>id</strong> (hex) comme contenu.</p><h1 class=h5 id=chiffrage-du-contenu><a class="text-body text-decoration-none" href=#chiffrage-du-contenu>Chiffrage du contenu</a></h1><h2 class=h6 id=chiffrage-des-réponses><a class="text-body text-decoration-none" href=#chiffrage-des-r%c3%a9ponses>Chiffrage des réponses</a></h2><p>Le chiffrage des réponses est supporté directement et de manière transparente. Le certificat de la requête/commande qui
est utilisé pour chiffrer la réponse (kind:6). Le module qui reçoit la réponse déchiffre de manière transparente le
contenu pour simuler une réponse de kind:4.</p><p>La réponse chiffrée est utile pour garantir la sécurité end-to-end d&rsquo;un contenu sensible qui peut inclure des clés
de déchiffrage ou de l&rsquo;information qui ne doit pas être interceptée (numéros de cartes de crédit/bancaire). Ces messages
ne peuvent pas être ouverts par les composants intermédiaires qui assurent le transit entre la base de données et
le composant requérant (e.g. navigateur de l&rsquo;usager).</p><h2 class=h6 id=chiffrage-des-requêtes-ou-commandes><a class="text-body text-decoration-none" href=#chiffrage-des-requ%c3%aates-ou-commandes>Chiffrage des requêtes ou commandes</a></h2>]]></description>
                    

                    
                        <guid isPermaLink="false">tag:www.millegrilles.com,2025-03-14:/fr/documentation/messages/</guid>
                    

                    
                        <link>https://www.millegrilles.com/fr/documentation/messages/</link>
                    

                    <atom:link href="https://www.millegrilles.com/fr/documentation/messages/" hreflang="fr" rel="self" type="text/html"/>

                    
                        

                        

                        <atom:link href="https://www.millegrilles.com/fr/documentation/messages/" hreflang="fr" rel="alternate" type="text/html"/>
                    

                    
                        
                            <atom:link href="https://www.millegrilles.com/documentation/messages/" hreflang="en" rel="canonical" type="text/html"/>
                        
                    

                    
                        <pubDate>Fri, 14 Mar 2025 12:20:48 UTC</pubDate>
                    

                    
                        <title>Structure des messages</title>
                    
                </item>
            
        
    </channel>
</rss>
